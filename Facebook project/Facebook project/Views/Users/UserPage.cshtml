@model Facebook_project.Models.AppUser
@{
	Layout = "_Layout";
}

<!DOCTYPE html>

<html>
<head>
	<meta name="viewport" content="width=device-width" />
	<title>_UserInfo</title>
</head>
<body>

    <div id="EditUserDataDiv"></div>

    @await Html.PartialAsync("~/Views/Posts/_Create.cshtml", new Post());

  
    <div class="container">
        <div class="row">
            <div class="col-3 mr-3 text-center">

                <img class="img-fluid rounded-circle" src="~/ProfilPics/@Model.PhotoURL" id="profilePicture" />
                <h2 id="fullname">@Model.FullName</h2>
                <p id="bio">@Model.Bio</p>
                <p id="birthdate">@Model.BirthDate.ToString("MM/dd/yyyy")</p>
                <p id="gender">@Model.Gender</p>

                <i class="fas fa-edit ml-2" onclick="EditUserDataModal()"></i>
            </div>

            <div class="col-8">
                <div>
                    <input type="text" style="height: 100px" readonly id="CreatePost" class="col-12"
                           data-toggle="modal" data-target="#openModal" value="What's on your mind" />
                </div>

                <div id="CreatePostInUserPageDiv"></div>

                @foreach (var item in Model.Posts)
                {
                    @await Html.PartialAsync("~/Views/Posts/_Post.cshtml", item);
                }
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

    <script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/mvc/4.0/jquery.validate.unobtrusive.min.js"></script>

    <script type="text/javascript">

        $(document).ready(function () {
        $("#CreatePost").click(function () {
            $("#PopupContainer").modal("toggle");
        });
    });

		function EditUserDataModal() {
        $.ajax({
            type: "GET",
            url: '@Url.Action("EditUserDataModal","Users")',
            success: function (response) {
                $("#EditUserDataDiv").html(response);
                $("#EditUserDataPopupContainer").modal("toggle");
            },
            error: function () {
                alert("Error retreiving Users");
            }
        });
		}

        function EditUserData() {

	    var fullname = document.querySelector('#fullname').value;
        var bio = document.querySelector('#bio').value;
        var birthdate = document.querySelector('#birthdate').value;
		var gender = document.querySelector('#gender').value;

			var data = new FormData();
			data.append("fullname", fullname);
			data.append("bio", bio);
			data.append("birthdate", birthdate);
			data.append("gender", gender);

        $.ajax({
            type: "POST",
            url: '@Url.Action("EditUserData","Users")',
            data: data,
            processData: false,
            contentType: false,
			success: function (response) {
				alert("succes");
                //var respPostId = Object.values(response)[0];
                //var respText = Object.values(response)[4];
                //var respImg = Object.values(response)[5];

                //var imgDivId = '#PostImgDiv' + postId
                //var textDivId = '#PostTextDiv' + postId


                //if (respImg == null) {
                //    respImg = "";
                //}

                //if (($(imgDivId)).children().length > 0) {

                //    var ImgTag = (document.querySelector(imgDivId)).firstElementChild;
                //    if (respImg == "")
                //        ImgTag.src = "";
                //    else
                //        ImgTag.src = '/PostsPics/' + respImg;
                //}
                //else {
                //    var ImgTag = '<img class="img-fluid" src="/PostsPics/' + respImg + '" />';
                //    (document.querySelector(imgDivId)).innerHTML += ImgTag;
                //}

                //if (respText != null) {

                //    if (($(textDivId)).children().length > 0) {

                //        var TextTag = (document.querySelector(textDivId)).firstElementChild;
                //        TextTag.innerText = respText;
                //    }
                //    else {
                //        var TextTag = '<p class="col-form-label">' + respText + '</p>';
                //        (document.querySelector(textDivId)).innerHTML += TextTag;
                //    }

                //}

            },
            error: function () {
                alert("Error Editing Post");
            }
        });
		}

        function addPost(signedInUserId) {
        var postText = document.querySelector("#postText").value;

        var data = new FormData();
        var files = $("#creatPostImgSelector").get(0).files;

        if (files.length > 0) {
            data.append("postImg", files[0]);
        }
        else {
            if (postText == "") {
                alert("Cannot create an empty post");
                return;
            }
        }

        data.append("postText", postText);

        $.ajax({
            type: "POST",
            url: '@Url.Action("AddPost","Users")',
            data: data,
            processData: false,
            contentType: false,

			success: function (response) {
				alert(response);
                document.querySelector("#CreatePostInUserPageDiv").insertAdjacentHTML('afterbegin', response);

                document.querySelector("#postText").value = "";
                document.querySelector('#creatPostImgSelector').remove();
                document.querySelector('#creatPostImgSelectorDiv').innerHTML += '<input type="file" name="file" id="creatPostImgSelector" style="width: 100%;" />';
                document.querySelector('#createPostImg').src = "";
            },
            error: function (response) {
                alert("Error submiting Post");
            }
        });

        $("#PopupContainer").modal("toggle");
    }
    </script>
</body>
</html>
